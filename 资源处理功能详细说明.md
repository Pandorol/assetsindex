# 资源处理功能详细说明文档

## 概述

本扩展提供了完整的Cocos Creator项目图片资源整理和移动功能，通过四个主要模块来处理项目中的图片资源分配和优化。

---

## 📊 第一部分：图片引用数据总览

### 基本设置

#### 1. 文件目录设置
- **功能**：设置要处理的目录
- **说明**：可选择设置任意一个文件夹进行操作，只会遍历这个文件夹(及子文件夹)内的所有预制体
- **使用方法**：
  - 在输入框中填入项目资源目录路径
  - 例如：`E:\project\assets\remotemain`
  - 建议选择包含所有预制体的根目录

#### 2. 构建基础数据按钮
- **功能**：扫描所有预制体和图片，建立引用关系表
- **说明**：生成双向索引数据，分析图片与预制体的引用关系
- **使用方法**：
  - 点击"构建基础数据，双向索引表"按钮
  - 等待扫描完成，系统会显示数据表路径

#### 3. 数据表路径
- **功能**：显示和设置生成的数据表文件位置
- **说明**：生成的数据表路径可以不用设置，会自动放在扩展文件夹中
- **使用方法**：
  - 系统自动生成路径，无需手动设置
  - 可以查看生成的数据表位置

#### 4. 生成图片引用表按钮
- **功能**：根据数据表生成可视化的图片引用关系表
- **说明**：点击图片生成引用表会根据数据表路径读取数据表生成双向引用表，可以看大致的情况
- **使用方法**：
  - 先确保已构建基础数据
  - 点击"生成图片引用表"按钮
  - 查看表格中的图片使用情况

#### 5. 删除空文件夹按钮
- **功能**：清理项目中的空文件夹
- **说明**：删除空文件夹就是删除空文件夹，保持目录结构整洁
- **使用方法**：
  - 点击"删除空文件夹"按钮
  - 系统会自动扫描并删除空目录

---

## ⚙️ 第二部分：设置图集参数

> **重要提示**：这个页面用于预处理要处理的图片文件，为下一个tab的移动操作做准备。建议按顺序设置这些图片集，记得先点击"定义大图"和"定义小图"，用于后续分类。

### 0. 忽略设置

#### 设置忽略图片按钮
- **功能**：跳过不需要处理的图片文件
- **说明**：设置忽略图片，跳过包含特定关键词的图片路径
- **使用方法**：
  - 在"忽略跳过包含"输入框中填入关键词
  - 多个关键词用逗号分隔，如：`i18,spine`
  - 点击"设置忽略规则"按钮
  - 查看筛选结果，跳过国际化、骨骼动画等特殊资源

### 1. 预处理阶段

#### 预处理完全一样的图片按钮
- **功能**：筛选对于完全一样的图，去除重复资源
- **说明**：尺寸大于设定值的完全相同图片只保留一份，其他多份的后面再看
- **使用方法**：
  - 设置宽度和高度阈值（如100x100=10000）
  - 点击"设置预处理规则"按钮
  - 系统会找出需要去重的大尺寸重复图片

#### 定义大图按钮（重要）
- **功能**：定义什么样的图片算作大图
- **说明**：先设置大图定义，后续操作依赖此设置。比如大图会放在bg文件夹，非大图放在atlas文件夹
- **使用方法**：
  - 设置大图尺寸阈值（如300x300=90000）
  - 选择判定条件：
    - ☑️ 宽度大于设定值就算大图
    - ☑️ 高度大于设定值就算大图  
    - ☑️ 宽高乘积大于设定值算大图
  - 点击"定义大图(放bg,其他放atlas)"按钮

#### 定义小图按钮（重要）
- **功能**：定义什么样的图片算作小图
- **说明**：必须先设置小图定义，后续操作依赖此设置。小图会被复制到各个单独目录
- **使用方法**：
  - 设置小图尺寸阈值（如50x50=2500）
  - 选择判定条件：
    - ☑️ 且宽度小于设定值才算小图
    - ☑️ 且高度小于设定值才算小图
    - ☑️ 且宽高乘积小于设定值才算小图
  - 点击"定义小图(复制到单独目录)"按钮

### 2. 分类筛选

#### 设置Common规则按钮
- **功能**：筛选对于引用次数超过阈值的图集
- **说明**：引用次数很多的图片统一放到common文件夹，便于管理和打包优化
- **使用方法**：
  - 设置引用次数阈值（如10次）
  - 点击"设置Common规则"按钮
  - 引用次数≥此值的图片会被标记为common类型

#### 设置单引用规则按钮
- **功能**：筛选单次引用的图
- **说明**：只被一个预制体引用的图片，直接放到该预制体对应的模块文件夹
- **使用方法**：
  - 点击"设置单引用规则"按钮
  - 系统会筛选只被引用一次的图片

#### 设置同目录规则按钮
- **功能**：筛选所有引用的预制体都在同一文件夹的图集
- **说明**：多次引用但所有引用的预制体都在同一目录下的图片，可以放到该目录的文件夹
- **使用方法**：
  - 点击"设置同目录规则"按钮
  - 系统会检查引用预制体的目录分布

### 3. 剩余处理

#### 设置大图处理按钮
- **功能**：其他的筛选大图
- **说明**：剩余的大图统一放到common文件夹进行管理
- **使用方法**：
  - 点击"设置大图处理"按钮
  - 前面筛选后剩余的大图会被标记为移动到common

#### 设置小图处理按钮
- **功能**：其他的筛选很小图
- **说明**：剩余的小图复制到各个引用的预制体目录，实现按需分发
- **使用方法**：
  - 点击"设置小图处理"按钮
  - 剩余的小图会被标记为复制到各引用目录

### 4. 批量操作

#### 一键计算所有设置按钮
- **功能**：按顺序设置这些图片集，以后可以编辑改成按自己选的顺序
- **说明**：自动按顺序执行：忽略→预处理→common→单引用→同目录→剩余大图→剩余小图
- **使用方法**：
  - 确保已设置大图和小图定义
  - 点击"一键计算所有设置"按钮
  - 系统会自动执行所有筛选规则

#### 查看最终剩余按钮
- **功能**：查看所有筛选后还剩余的图片
- **使用方法**：
  - 点击"查看最终剩余"按钮
  - 查看未被任何规则处理的图片

---

## 🚀 第三部分：处理和移动图片

> **重要注意事项**：
> - **移动前先预查看** - 确认移动计划正确
> - **移动过程中同一个目录可能有同名文件** - 可以默认重命名或等待弹窗选择  
> - **弹窗会影响其他文件移动超时** - 所以最后会把超时的文件重新移动
> - **如果还有弹窗** - 建议重导数据再来(去第一部分重新构建数据导入数据)

### 0. 冲突处理设置

#### 文件夹大小写冲突处理策略
- **保留旧文件夹名**：遇到大小写冲突时保持原有文件夹名
- **使用新文件夹名**：遇到大小写冲突时使用新的文件夹名

#### 自动重命名冲突文件
- **功能**：当目标位置存在同名文件时自动重命名
- **说明**：启用后会自动处理文件名冲突，避免覆盖

### 1. 预处理阶段

#### 预处理完全相同的图和预制体引用重新指向按钮
- **功能**：根据刚刚筛选出来的图集，按自己想要的方式进行处理
- **说明**：删除重复图片并更新预制体引用，必须在移动操作前执行
- **使用方法**：
  - 点击"预处理完全相同的图和预制体引用重新指向"按钮
  - 等待处理完成

### 2. 具体移动操作

#### 移动Common图片按钮
- **功能**：将高频引用的图片移动到common文件夹
- **说明**：根据大小分别放到bg或atlas子目录
- **使用方法**：
  - 设置目标路径：
    - 大图：`remotemain/staticRes/common/bg/`
    - 非大图：`remotemain/staticRes/common/atlas/`
  - 点击"预查看需要移动的图"先预览
  - 确认无误后点击"移动Common图片"

#### 移动单引用图片按钮
- **功能**：将只被一个预制体引用的图片移动到该预制体对应的模块文件夹
- **使用方法**：
  - 设置Prefab正则：`remotemain/preb[/\\](.*)[/\\](.*)\.prefab`
    - $1表示预制体所在文件夹名称
    - $2表示预制体名称
  - 设置目标路径：
    - 大图：`remotemain/staticRes/$1/bg/`
    - 非大图：`remotemain/staticRes/$1/atlas/`
  - 点击"预查看需要移动的图"先预览
  - 确认无误后点击"移动单引用图片"

#### 移动同目录图片按钮
- **功能**：将所有引用的预制体都在同一目录下的图片移动到该目录对应的模块文件夹
- **使用方法**：
  - 设置Prefab正则和目标路径（同单引用设置）
  - 点击"预查看需要移动的图"先预览
  - 确认无误后点击"移动同目录图片"

#### 移动其他大图按钮
- **功能**：将剩余的大图统一移动到common文件夹进行管理
- **使用方法**：
  - 设置目标路径：`remotemain/staticRes/common/bg/`
  - 点击"预查看需要移动的图"先预览
  - 确认无误后点击"移动其他大图"

#### 复制小图到各目录按钮
- **功能**：将剩余的小图复制到各个引用它的预制体对应的模块目录
- **说明**：实现按需分发，每个使用该图片的模块都会有一份副本
- **使用方法**：
  - 设置Prefab正则：`remotemain/preb[/\\](.*)[/\\](.*)\.prefab`
  - 设置目标路径：`remotemain/staticRes/$1/atlas/`
  - 点击"预查看需要移动的图"先预览
  - 确认无误后点击"复制小图到各目录"

---

## 🎮 第四部分：GameRes路径图片

> **功能说明**：移动和批量移动某些图片到指定文件夹，主要用于动态文件夹的图片被移动的情况

### 动态移动配置

#### 添加移动项按钮
- **功能**：添加一个新的图片移动规则
- **使用方法**：
  - 点击"添加移动项"按钮
  - 在弹出的配置中设置移动规则
  - 可以添加多个不同的移动项

#### 导入移动项按钮
- **功能**：从文件导入移动配置
- **使用方法**：
  - 点击"导入移动项"按钮选择配置文件
  - 右键点击可查看格式说明
  - 支持批量导入预设的移动规则

#### 导出移动项按钮
- **功能**：保存当前配置到文件
- **使用方法**：
  - 配置好移动项后点击"导出移动项"
  - 选择保存位置
  - 便于重复使用和分享配置

#### 格式说明按钮
- **功能**：查看导入配置格式说明
- **使用方法**：
  - 点击"❓ 格式说明"查看详细的配置文件格式
  - 了解如何编写自定义配置

### 批量操作

#### 预览所有选中按钮
- **功能**：查看所有选中项的移动计划
- **使用方法**：
  - 选中需要执行的移动项
  - 点击"预览所有选中"查看移动计划
  - 确认移动的文件和目标位置

#### 移动所有选中按钮
- **功能**：执行实际的文件移动操作
- **使用方法**：
  - 预览确认无误后点击"移动所有选中"
  - 系统会执行所有选中的移动规则
  - **注意**：这是实际的文件操作，请谨慎使用

---

## 📋 使用流程建议

### 标准处理流程：

1. **数据准备阶段**：
   - 设置项目目录
   - 构建基础数据
   - 生成图片引用表

2. **参数设置阶段**：
   - 设置忽略规则
   - 定义大图和小图标准（重要）
   - 设置各种分类规则
   - 执行一键计算

3. **移动执行阶段**：
   - 设置冲突处理策略
   - 预处理相同图片
   - 按顺序执行各类图片移动
   - 每次移动前先预查看

4. **特殊处理阶段**：
   - 使用GameRes功能处理特殊需求
   - 导入导出配置便于重复使用

### 注意事项：

- 移动操作不可逆，务必先预查看
- 建议在操作前备份项目
- 遇到弹窗及时处理，避免超时
- 大项目建议分批处理
- 定期清理空文件夹保持目录整洁

---

## 🔧 故障排除

### 常见问题：

1. **移动超时**：弹窗影响导致，重新执行移动操作
2. **路径错误**：检查正则表达式和目标路径模板
3. **权限问题**：确保对目标目录有写入权限
4. **文件被占用**：关闭相关编辑器和工具

### 解决方案：

- 出现问题时可以重导数据重新开始
- 使用预查看功能确认操作正确性
- 分小批次处理大量文件
- 保持项目文件未被其他程序占用
