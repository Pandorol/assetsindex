<script src="../../libs/clusterize.js"></script>
<link href="../../style/resourcesdeal/clusterize.css" rel="stylesheet">
<div >
    <div id="tabs">
        <button id="tab1" class="tab-button active" data-tab="panel1">图片引用数据总览</button>
        <button id="tab2" class="tab-button" data-tab="panel2">设置图集参数</button>
        <button id="tab3" class="tab-button" data-tab="panel3">处理和移动图片</button>
    </div>
    <div id="content">
        <div id="panel1" class="tab-content active" style="overflow: auto;">
            <div>填入一个文件目录:</div>
            <!-- 目录输入框 长度最长  -->
            <div >
                <input type="text" id="directoryInput" placeholder="输入目录路径" style="width: 80%;" />
            </div>
            <!-- 构建基础数据按钮 -->
            <button id="buildmapsdatabtn">构建基础数据，双向索引表</button>
            <div id="buildMapsDataResultContainer" style="visibility: visible;">
                <div>生成的数据表，用于读取和生成</div>
                <div>
                    <input type="text" id="buildMapsDataResultPath" placeholder="读取数据表路径" style="width: 80%;" />
                </div>
                
            </div>
            
            <!-- 按钮和列表 -->
            <!-- 表格生成按钮 -->
            <div style="margin-top:10px;">
                <button id="genImageTableBtn">生成图片引用表</button>
                <!-- <button id="genPrefabTableBtn">生成预制体引用表</button> -->
            </div>

            <!-- 图片路径-引用表 -->
            <!-- <div id="imageTableContainer" style="margin-top:20px;height:300px; overflow:auto; border:1px solid #ccc;">
                <h3>图片引用表</h3>
                <table id="imageTable" border="1" cellspacing="0" cellpadding="5" style="width:100%; color:white;">
                    <thead>
                        <tr>
                            <th>图片路径</th>
                            <th>引用次数</th>
                            <th>大小</th>
                            <th>被引用预制体</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div> -->
            <div id="scrollArea" style="height:300px; overflow:auto; border:1px solid #ccc;">
                <table id="imageTable" border="1" cellspacing="0" cellpadding="5" style="width:100%; color:white;">
                    <thead>
                        <tr>
                            <th>图片路径</th>
                            <th>引用次数</th>
                            <th>大小</th>
                            <th>被引用预制体</th>
                        </tr>
                    </thead>
                    <tbody id="contentArea"></tbody>
                </table>
            </div>

            <!-- 统计区域 -->
            <div id="imageStatsContainer" style="margin-top:10px; padding:10px; border:1px solid #666; color:white; background:#222;height:300px; overflow:auto;">
                <h4>图片引用统计 <span id="imageStatsPicUsed"></span></h4>
                <div id="imageStatsContent">暂无统计数据</div>
            </div>
        </div>
        <div id="panel2" class="tab-content" style="overflow: auto;">
            <!--忽略跳过包含xx的内容-->
            <h2>忽略跳过路径包含xx的内容</h2>
            <div>
                <label for="ignorePattern">忽略跳过包含:</label>
                <input type="text" id="ignorePattern" value="i18,spine" style="width: 400px;"/>
                <span>多个用逗号分隔</span>
            </div>
            <div><button id="setIgnorePatternBtn">设置</button></div>
            <div id="ignoreResult">
                共 <span id="ignoreTotal">0</span> 张，总大小 <span id="ignoreTotalSize">0</span> KB, 剩余 <span id="ignoreRemaining">0</span> 张待处理
                <button id="lookIgnorePatternResult">查看忽略内容</button>
            </div>
            <div style="height: 20px;"></div>
            
            <!-- 预处理区域 与 大图定义 并排显示 -->
            <div style="display: flex; gap: 20px; align-items: flex-start;">
                <div style="flex: 1;">
                    <h2>0、预处理完全一样的图片</h2>
                    <h2>尺寸大于多少的只保留一份,其他多份的的后面再看</h2>
                    <div>
                        <label for="preImageThreshold">图片尺寸(只对比宽高乘积不单独比较宽高):</label>
                        <input type="number" id="preimgWidthinput" value="100" style="width:60px;"/>
                        <label>X</label>
                        <input type="number" id="preimgHeightinput" value="100" style="width:60px;"/>
                        <label>=</label>
                        <input type="number" id="preImageThreshold" value="10000" style="width:120px;" readonly/>
                        <span></span>
                    </div>
                    <div><button id="calculatePreSameImageBtn">设置</button></div>
                    <div id="preImageResult">
                        删除 <span id="preImageTotal">0</span> 张，保留<span id="preImagesaving">0</span> 张，剩余 <span id="preImageRemaining">0</span> 张待处理
                        <button id="lookPreImageResultBtn">查看预处理结果</button>
                    </div>
                </div>
                
                <!-- 大图定义 - 右侧独立区域 -->
                <div style="flex: 1; border: 1px solid #444; padding: 15px; border-radius: 5px; background-color: rgba(0, 122, 204, 0.1);">
                    <h2 style="margin-top: 0;">大图定义</h2>
                    <div>
                        <label for="defineLargeImageThreshold">大图文件尺寸:</label>
                        <input type="number" id="defineLargeImageWidth" value="300" style="width:60px;"/>
                        <label>X</label>
                        <input type="number" id="defineLargeImageHeight" value="300" style="width:60px;"/>
                        <label>=</label>
                        <input type="number" id="defineLargeImageThreshold" value="90000" style="width:120px;" readonly/>
                        <span></span>
                    </div>
                    <div style="display: flex;">
                        <!-- 3个复选框 宽大于就算大图，高大于就算大图，宽高乘积才算大图 -->
                        <input type="checkbox" id="defineLargeImageByWidth" checked>
                        <label for="largeImageByWidth">宽大于就算大图</label><br>
                        <input type="checkbox" id="defineLargeImageByHeight" checked>
                        <label for="largeImageByHeight">高大于就算大图</label><br>
                        <input type="checkbox" id="defineLargeImageByArea" checked>
                        <label for="largeImageByArea">宽高乘积大于算大图</label>
                    </div>
                    <button id="defineLargeImageBtn" style="background-color: #007acc; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">定义大图(放bg,其他放atlas)</button>
                </div>
            </div>

            <div style="height: 20px;"></div>

            <!-- 引用次数设置与小小图定义 并排显示 -->
            <div style="display: flex; gap: 20px; align-items: flex-start;">
                <div style="flex: 1;">
                    <h2>1、引用次数超过或等于多少个的放common</h2>
                    <div>
                        <label for="commonThreshold">Common 文件夹引用阈值:</label>
                        <input type="number" id="commonThreshold" value="10" />
                    </div>
                    <div><button id="calculateCommon">设置</button></div>
                    <div id="commonResult">
                        共 <span id="commonTotal">0</span> 张，总大小 <span id="commonTotalSize">0</span> KB, 剩余 <span id="commonRemaining">0</span> 张待处理
                        <button id="lookCommonResult">查看common结果</button>
                    </div>
                </div>
                
                <!-- 小小图定义 - 右侧独立区域 -->
                <div style="flex: 1; border: 1px solid #444; padding: 15px; border-radius: 5px; background-color: rgba(0, 122, 204, 0.1);">
                    <h2 style="margin-top: 0;">小图定义</h2>
                    <div>
                        <label for="defineSSmallImageThreshold">小图文件尺寸:</label>
                        <input type="number" id="defineSSmallImageWidth" value="50" style="width:60px;"/>
                        <label>X</label>
                        <input type="number" id="defineSSmallImageHeight" value="50" style="width:60px;"/>
                        <label>=</label>
                        <input type="number" id="defineSSmallImageThreshold" value="2500" style="width:120px;" readonly/>
                        <span></span>
                    </div>
                    <div style="display: flex;">
                        <!-- 3个复选框 宽小于就算小小图，高小于就算小小图，宽高乘积才算小小图 -->
                        <input type="checkbox" id="defineSSmallImageByWidth" checked>
                        <label for="smallImageByWidth">宽小于就算小图</label><br>
                        <input type="checkbox" id="defineSSmallImageByHeight" checked>
                        <label for="smallImageByHeight">高小于就算小图</label><br>
                        <input type="checkbox" id="defineSSmallImageByArea" checked>
                        <label for="smallImageByArea">宽高乘积小于算小图</label>
                    </div>
                    <button id="defineSSmallImageBtn" style="background-color: #007acc; color: white; border: none; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">定义小图(复制到单独目录)</button>
                </div>
            </div>

            <div style="display: none;">
            <div style="height: 20px;"></div>
            <h2>1、大图文件夹尺寸超过或等于多少的放bg</h2>
            <div>
                <label for="largeImageThreshold">大图文件夹尺寸(只对比宽高乘积不单独比较宽高):</label>
                <input type="number" id="bgimgWidthinput" value="400" style="width:60px;"/>
                <label>X</label>
                <input type="number" id="bgimgHeightinput" value="400" style="width:60px;"/>
                <label>=</label>
                <input type="number" id="largeImageThreshold" value="160000" style="width:120px;"/>
                <span></span>
                <button id="calculateBg">设置</button>
            </div>
            <div id="bgResult">
                共 <span id="bgTotal">0</span> 张，总大小 <span id="bgTotalSize">0</span> KB, 剩余 <span id="bgRemaining">0</span> 张待处理
                <button id="lookBgResult">查看大图结果</button>
            </div>
            </div>

            <!-- single文件夹 只有单次引用的直接放对应预制体路径文件夹 -->
            <div style="height: 20px;"></div>
            <h2>2、单次引用的放对应预制体路径文件夹</h2>
            <div>
                <button id="calculateSingle">设置</button>
            </div>
            <div id="singleResult">
                共 <span id="singleTotal">0</span> 张，总大小 <span id="singleTotalSize">0</span> KB, 剩余 <span id="singleRemaining">0</span> 张待处理
                <button id="lookSingleResult">查看single结果</button>
            </div>
            <div style="height: 20px;"></div>
            <h2>3、检查所有引用的预制体都是在同一目录的,</h2>
            
            <div>
                <button id="calculateSameDir">设置</button>
            </div>
            <div id="sameDirResult">
                共 <span id="sameDirTotal">0</span> 张，总大小 <span id="sameDirTotalSize">0</span> KB, 剩余 <span id="sameDirRemaining">0</span> 张待处理
                <button id="lookSameDirResult">查看sameDir结果</button>
            </div>
            <!-- 图片大小*引用次数<=多少时,复制图使其单独引用到对应预制体路径 -->
            <div style="height: 20px;"></div>
            <div style="display: none;">
            <h2>4、图片大小*引用次数&lt;=多少时,复制图使其单独引用到对应预制体路径</h2>
            <div>
                <label for="sizeCountThreshold">图片大小*引用次数阈值:</label>
                <input type="number" id="sizecountWidthinput" value="100" style="width:60px;"/>
                <label>X</label>
                <input type="number" id="sizecountHeightinput" value="100" style="width:60px;"/>
                <label>X</label>
                <input type="number" id="sizecountCountinput" value="100" style="width:60px;"/>
                <label>=</label>
                <input type="number" id="sizeCountThreshold" value="1000000" style="width:180px;"/>
                <span></span>
                <button id="calculateSizeCount">设置</button>
            </div>
            <div id="sizeCountResult">
                共 <span id="sizeCountTotal">0</span> 张，总大小 <span id="sizeCountTotalSize">0</span> KB, 剩余 <span id="sizeCountRemaining">0</span> 张待处理
                <button id="lookSizeCountResult">查看sizeCount结果</button>
            </div>
            </div>
            <h2>4、引用不多的</h2>
            <!--弄几个复选框-->
            <div style="display: table; ">
                <div style="display: table-cell; width: 200px;">
                    <button id="otherbigToCommonBtn">设置</button>
                    <label>大图扔common去处理</label>
                </div>
                <div style="display: table-cell;width:240px;">
                    共 <span id="otherbigTotal">0</span> 张，总大小 <span id="otherbigTotalSize">0</span> KB, 剩余 <span id="otherbigRemaining">0</span> 张待处理
                </div>
                <div style="display: table-cell; width: 100px;">
                    <button id="lookotherbigResult">查看大图结果</button>
                </div>
            </div>
            <div style="display: table; ">
                <div style="display: table-cell; width: 200px;">
                    <button id="othersmallToCopyMoreBtn">设置</button>
                    <label>小图复制多份</label>
                </div>
                <div style="display: table-cell;width: 240px;">
                    共 <span id="othersmallTotal">0</span> 张，总大小 <span id="othersmallTotalSize">0</span> KB, 剩余 <span id="othersmallRemaining">0</span> 张待处理
                </div>
                <div style="display: table-cell; width: 100px;">
                    <button id="lookothersmallResult">查看小图结果</button>
                </div>
            </div>
            <!-- 处理按钮 一键计算-->
            <div style="margin-top:20px;">
                <button id="processAll">一键计算所有设置</button>
            </div>
        </div>
        <div id="panel3" class="tab-content">
            <!--加个单选框 -->
            <div>
                <label>移动过程中文件夹大小写冲突处理策略:</label>
                <input type="radio" id="caseConflictKeepOld" name="caseConflictStrategy" value="keepOld" checked>
                <label for="caseConflictKeepOld">保留旧文件夹名</label>
                <input type="radio" id="caseConflictUseNew" name="caseConflictStrategy" value="useNew">
                <label for="caseConflictUseNew">使用新文件夹名</label>
            </div>
            <div>
                <h2 style="color: #007acc;">移动过程中移动到同目录的同名文件，会弹窗询问处理，取消不会移动，重名名会自动重命名，覆盖会全部丢失</h2>
                <h2 style="color: #007acc;">弹窗会影响其他文件移动超时，所以最后会把超时的文件重新移动，还有弹窗的话就重导数据再来</h2>
            </div>
            <!--先预处理那些完全相同的图和预制体引用重新指向-->
            <div >
                0.<button id="preprocessIdenticalImagesBtn" style="height: 25px;">预处理完全相同的图和预制体引用重新指向</button>
                <!-- <button id="lookPreprocessIdenticalImagesBtn" style="height: 25px;">预查看预处理结果</button> -->
            </div>
            <div style="display: none;">
            <!-- 移动大图按钮 -->
            <h2>1、移动大图  大图直接移动到第一个应用的预制体的模块目录去</h2>
            <!-- 取目录和设置目录 -->
             <label>Prefab 正则:</label>
            <input type="text" id="bgPrefabRegex" value="remotemain/preb[/\\](.*)[/\\](.*)\.prefab" style="width: 400px;"/>

            <label>目标路径模板:</label>
            <input type="text" id="bgTargetPattern" value="remotemain/staticRes/$1/bg/" style="width: 400px;"/>
            <div>
                这个正则preb[/\\](.*)[/\\](.*)\.prefab 表示匹配 preb/scene1/active/kill/xx.prefab 这种格式
                <br />
                <!--$1=scene1/active/kill 这个标红 -->
                <span>说明: $1表示预制体所在文件夹名称, 例如: preb/scene1/active/kill/xx.prefab 则<span style="color: #007acc;">$1=scene1/active/kill</span></span>
                <br />
                <span>说明: $2表示预制体名称, 例如: preb/scene1/active/kill/xx.prefab 则<span style="color: #007acc;">$2=xx</span></span>
            </div>
            <div>
                <button id="moveBgImagesBtn">移动</button>
                <button id="PreLookmoveBgImagesBtn">预查看需要移动的图</button>
            </div>
            </div>
            <div style="height: 20px;"></div>
            <h2>1、移动common图  直接移动到指定文件夹</h2>
            <!-- 取设置目录 -->
             <div>
                <label>目标路径模板:</label>
             </div>
             <div>
                <label>大图：</label> <input type="text" id="bigcommonTargetPattern" value="remotemain/staticRes/common/bg/" style="width: 400px;"/>
                <label>非大图：</label> <input type="text" id="commonTargetPattern" value="remotemain/staticRes/common/atlas/" style="width: 400px;"/>
            </div>
           
            <div>
                <button id="moveCommonImagesBtn">移动</button>
                <button id="PreLookmoveCommonImagesBtn">预查看需要移动的图</button>
            </div>
            <h2>2、移动单引用图  直接移动到对应模块文件夹</h2>
            <!-- 取目录和设置目录 -->
             <label>Prefab 正则:</label>
            <input type="text" id="singlePrefabRegex" value="remotemain/preb[/\\](.*)[/\\](.*)\.prefab" style="width: 400px;"/>
            <div><label>目标路径模板:</label></div>
            <div>
                <label>大图：</label><input type="text" id="bigsingleTargetPattern" value="remotemain/staticRes/$1/bg/" style="width: 400px;"/>
                <label>非大图：</label><input type="text" id="singleTargetPattern" value="remotemain/staticRes/$1/atlas/" style="width: 400px;"/>
            </div>
            
            <div>
                <button id="moveSingleImagesBtn">移动</button>
                <button id="PreLookmoveSingleImagesBtn">预查看需要移动的图</button>
            </div>
            <h2>3、移动引用预制体图都在同一目录图  直接移动到对应模块文件夹</h2>
            <!-- 取目录和设置目录 -->
             <label>Prefab 正则:</label>
            <input type="text" id="sameDirPrefabRegex" value="remotemain/preb[/\\](.*)[/\\](.*)\.prefab" style="width: 400px;"/>
            <div><label>目标路径模板:</label></div>
            <div>
                <label>大图：</label><input type="text" id="bigsameDirTargetPattern" value="remotemain/staticRes/$1/bg/" style="width: 400px;"/>
                <label>非大图：</label><input type="text" id="sameDirTargetPattern" value="remotemain/staticRes/$1/atlas/" style="width: 400px;"/>
            </div>
            
            <div>
                <button id="moveSameDirImagesBtn">移动</button>
                <button id="PreLookmoveSameDirImagesBtn">预查看需要移动的图</button>
            </div>
        </div>
    </div>

</div>