# AssetsIndex 扩展使用手册

## 📋 目录

- [概述](#概述)
- [安装说明](#安装说明)
- [功能总览](#功能总览)
- [详细使用指南](#详细使用指南)
  - [1. 构建索引表](#1-构建索引表)
  - [2. 资源处理](#2-资源处理)
- [配置说明](#配置说明)
- [最佳实践](#最佳实践)
- [故障排除](#故障排除)

## 概述

AssetsIndex 是一个专为 Cocos Creator 开发的资源管理扩展，主要用于：

- 🗂️ **资源索引生成**：自动生成构建后的资源索引表
- 🖼️ **图片资源优化**：识别和处理重复图片、大图、小图等
- 📁 **智能资源整理**：按规则自动移动和分类项目资源
- 🔗 **引用关系管理**：自动更新预制体中的资源引用
- 🧹 **项目清理**：删除空文件夹，优化项目结构

**支持版本**：Cocos Creator >= 3.7.4

## 安装说明

### 方法一：项目级安装（推荐）
1. 下载 `assetsindex-extension.zip`
2. 解压到你的 Cocos Creator 项目的 `extensions` 目录：
   ```
   YourProject/
   ├── assets/
   ├── extensions/
   │   └── assetsindex/     ← 解压到这里
   ├── settings/
   └── project.json
   ```
3. 重启 Cocos Creator

### 方法二：全局安装
1. 解压到 Cocos Creator 全局扩展目录：
   - Windows: `%USERPROFILE%\.CocosCreator\extensions\`
   - Mac: `~/.CocosCreator/extensions/`
   - Linux: `~/.CocosCreator/extensions/`

### 验证安装
安装成功后，在 Cocos Creator 菜单栏会出现：
- `扩展` → `构建索引表`
- `扩展` → `资源处理`

## 功能总览

### 🏗️ 构建索引表功能
- 扫描构建后的 bundle 配置文件
- 生成 `assetsindex.json` 资源索引
- 支持主包和远程包资源

### 🎨 资源处理功能
- **数据分析**：分析项目中的图片资源使用情况
- **重复图片处理**：识别并合并重复的图片资源
- **资源分类**：按使用模式分类（背景图、通用图、单独使用图等）
- **智能移动**：按预制体路径规则自动移动资源
- **批量操作**：支持预览和批量执行

## 详细使用指南

## 1. 构建索引表

### 用途
为构建后的项目生成资源索引表，用于运行时动态加载资源。

### 操作步骤
1. 先在 Cocos Creator 中构建项目
2. 打开 `扩展` → `构建索引表`
3. 选择构建平台目录
4. 点击 `生成索引表`
5. 在构建目录下会生成 `assetsindex.json`

### 索引表格式
```json
{
  "texture/ui/button": "remotemain",
  "texture/bg/scene1": "resources",
  "audio/bgm/menu": "remotebundle2"
}
```

## 2. 资源处理

资源处理是本扩展的核心功能，包含多个子功能模块。

### 2.1 数据建立与分析

#### 步骤 1：建立映射数据
```
1. 打开 "扩展" → "资源处理"
2. 在 "数据建立" 标签下
3. 设置 assets 目录路径（通常自动填充）
4. 点击 "建立映射数据"
5. 等待分析完成（大项目可能需要1分钟）
```

**分析结果包含**：
- 预制体与图片的引用关系
- 图片的详细信息（尺寸、大小、MD5等）
- 使用统计和重复检测

#### 步骤 2：查看分析结果
- **图片表格**：显示所有图片资源的详细信息
- **预制体表格**：显示预制体的资源依赖关系
- **统计信息**：项目资源概览

### 2.2 图片分类定义

#### 大图定义
```
用途：定义什么尺寸的图片算作"大图"
配置：
- 宽度阈值：如 500px
- 高度阈值：如 500px  
- 面积阈值：如 250000px²
- 判断条件：可选择按宽度、高度或面积判断
- 用于后续移动时候的分目录存放
```

#### 小小图定义
```
用途：定义极小图片的标准（通常用于图标、按钮等）
配置：
- 宽度阈值：如 50px
- 高度阈值：如 50px
- 面积阈值：如 2500px²
- 用于后续移动时候的分目录存放
```

### 2.3 资源分类计算

#### 忽略图片
```
用途：排除不需要处理的图片
配置：忽略路径包含的（如 "i18,spine"）
作用：被忽略的图片不会参与后续的操作
```

#### 重复图片
```
用途：找出内容完全相同的图片文件
原理：基于文件 MD5 值比较
操作：
1. 设置最小尺寸阈值（0,0,0处理所有）
2. 点击 "计算重复图片"
3. 查看重复图片列表和预计节省空间
```

#### 背景图片
```
用途：识别大尺寸的背景图片
配置：
- 最小宽度：如 800px
- 最小高度：如 600px
- 面积阈值：如 480000px²
特点：通常是场景背景、大型UI背景等
```

#### 通用图片
```
用途：被多个预制体引用的图片
配置：最小引用次数阈值（如 10次以上）
特点：适合打包到通用图集中
```

#### 单独使用图片
```
用途：只被单个预制体引用的图片
特点：可以与对应预制体一起管理
```

#### 同目录图片
```
用途：位于同一目录下的相关图片
应用：目录结构相关的资源组织
```

#### 尺寸数量分类，暂时屏蔽掉了
```
用途：特定尺寸且数量较多的图片
配置：
- 目标宽度：如 100px
- 目标高度：如 100px  
- 最小数量：如 5个
例如：所有 100x100 的图标，数量超过5个的
```
#### 剩余的大图
#### 剩余的小图

### 2.4 资源移动操作

#### 预处理重复图片
```
功能：合并重复图片，更新引用关系
操作：
1. 先计算重复图片
2. 点击 "预处理重复图片"
3. 系统会：
   - 保留每组重复图片中的第一个
   - 删除其他重复文件
   - 更新所有预制体中的引用
```


#### 移动通用图片
```
配置示例(assets下)：
- 大图路径：staticRes/common/big/
- 大图路径：staticRes/common/altas/
效果：被多个预制体共用的图片移动到公共目录
```

#### 移动其他类型图片
类似配置方式，支持：
- 单独使用图片
- 同目录图片  
- 其他大图
- 其他小图

### 2.5 冲突处理策略

#### 大小写冲突
```
- 保持旧名称：使用已存在的目录名
- 使用新名称：重命名现有目录为新名称
```

#### 文件名冲突
```
- 跳过：保留现有文件，不执行操作
- 覆盖：删除现有文件，移动新文件
- 重命名：自动重命名新文件（如 image_1.png）
```

### 2.6 批量操作

#### 预览模式
```
所有移动操作都支持预览模式：
1. 点击 "预览" 按钮
2. 查看将要执行的操作列表
3. 确认无误后再执行实际操作
```

#### 批量执行
```
支持一次性处理多种类型的资源：
1. 配置各类资源的移动规则
2. 使用 "处理全部" 功能
3. 按顺序自动执行所有操作
```

## 配置说明

### 正则表达式配置

#### 预制体路径匹配
```
示例：preb/(.*?)/(.*?).prefab
解释：
- preb/ : 匹配以 "preb/" 开头的路径
- (.*?) : 第一个捕获组，匹配任意字符（非贪婪）
- / : 匹配路径分隔符
- (.*?) : 第二个捕获组
- .prefab : 匹配文件扩展名
```

#### 目标路径模板
```
示例：staticRes/$1/$2/
解释：
- staticRes/ : 固定前缀
- $1 : 第一个捕获组的内容
- $2 : 第二个捕获组的内容
- / : 路径分隔符

实际效果：
preb/scene1/main.prefab → staticRes/scene1/main/
```

### 阈值配置

#### 图片尺寸阈值
- **大图阈值**：通常设置为 500x500 或更大
- **小图阈值**：通常设置为 50x50 或更小
- **面积阈值**：宽度×高度的乘积

#### 引用次数阈值
- **通用图片**：建议设置为 3-5 次
- **批量处理**：可以设置更高的阈值

## 最佳实践

### 使用前准备
1. **备份项目**：使用版本控制系统
2. **完整构建**：确保项目可以正常构建
3. **测试环境**：先在测试项目中验证

### 推荐工作流程
```
1. 建立映射数据
2. 定义图片分类阈值
3. 计算各类图片分类
4. 处理重复图片
5. 预览移动操作
6. 按类型依次移动资源
7. 清理空文件夹
8. 测试项目运行
```

## 故障排除

### 常见问题

#### 1. 扩展无法显示
```
问题：菜单中没有扩展选项
解决：
1. 检查扩展文件夹名称是否为 "assetsindex"
2. 检查 package.json 文件是否存在
3. 重启 Cocos Creator
4. 查看控制台错误信息
```

#### 2. 移动操作失败
```
问题：资源移动时出现错误
解决：
1. 检查目标路径是否有写权限
2. 确认资源文件没有被其他程序占用
3. 查看控制台的详细错误信息
4. 尝试手动创建目标目录
```

#### 3. 引用更新失败
```
问题：预制体引用没有正确更新
解决：
1. 确认源文件和目标文件都存在
2. 检查 .meta 文件是否正常
3. 尝试刷新资源数据库
4. 手动检查 UUID 是否正确
```

#### 4. 性能问题
```
问题：处理大项目时速度很慢
解决：
1. 关闭不必要的应用程序
2. 分批处理资源
3. 暂时关闭实时预览
4. 增加超时时间设置
```

### 日志分析

#### 正常日志
```
[12:34:56] 进度: [1/100] 正在处理: image.png
复制成功: image.png
更新预制体引用: scene/main.prefab - 替换 uuid1 → uuid2
```

#### 错误日志
```
目标文件已存在，跳过复制: image.png
无法获取源图片 UUID: path/image.png - 未找到 sprite-frame
移动异常: image.png - 权限不足
```

### 数据恢复

#### 操作回滚
```
如果操作出现问题：
1. 使用版本控制系统回滚
2. 从备份中恢复文件
3. 手动调整资源引用
4. 重新生成 .meta 文件
```

## 技术支持

### 获取帮助
- 查看控制台日志获取详细错误信息
- 检查项目结构是否符合扩展要求
- 确认 Cocos Creator 版本兼容性

### 反馈问题
提供以下信息：
- Cocos Creator 版本号
- 操作系统版本
- 详细的操作步骤
- 完整的错误日志
- 项目结构示例

---

**版本**：1.0.0  
**作者**：CJJ (820003986@qq.com)  
**更新日期**：2025年9月2日
